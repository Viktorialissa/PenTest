##### Alisa Ahokas

# Lab kid
<!-- Up -->

#### Aloitetaan teht√§vien tekeminen üìÜ 07.11.2023 üïí 14.00 ja luetaan [teht√§v√§nanto](https://terokarvinen.com/2023/eettinen-hakkerointi-2023/#h3-lab-kid).

## x) Lue ja tiivist√§

### [HTB: MIRAI](https://0xdf.gitlab.io/2022/05/18/htb-mirai.html)

Mirai niminen RaspberryPi-laite, jossa oli tietoturvaongelmia, koska siin√§ oli edelleen oletus k√§ytt√§j√§nimi ja salasana.

Skannaus tehtiin nmapilla komennolla:

	nmap -p- --min-rate 10000 10.10.10.48

ja l√∂ytyi kuusi avointa porttia.

```
PORT      STATE SERVICE
22/tcp    open  ssh
53/tcp    open  domain
80/tcp    open  http
1877/tcp  open  hp-webqosdb
32400/tcp open  plex
32469/tcp open  unknown
```

Seuraavaksi etsittiin hakemistoja feroxbusterilla k√§ytt√§en komentoa:

	feroxbuster -u http://10.10.10.48

``/admin`` l√∂ytyi, kuten oli oletettu.

H√§n k√§y admin-sivulla, mutta ei ole k√§ytt√§j√§tunnuksia.

H√§n vierailee t√§ss√§ avoimen portin palvelussa:
HTTP / Plex - TCP 32400
This site is a Plex media server
Seuraavaksi h√§n luo tilin tuonne, mutta ei hy√∂dy siit√§ mit√§√§n.

Sitten h√§n k√§y DNS - TCP 53 portin palvelussa. H√§n k√§ytt√§√§ esim. komentoa:

	dig axrf @10.10.10.48 [zone]

Mutta ei l√∂yd√§ mit√§√§n mielenkiintoista.

Seuraavaksi h√§n kirjautuu Raspberry Pi:hin k√§ytt√§m√§ll√§ oletustunnuksia, jotka ovat pi / raspberry komennolla:

	sshpass -p raspberry ssh pi@10.10.10.48

Lopulta h√§n l√∂ysi lipun k√§ytt√§m√§ll√§ monia eri komentoja.


### Nyrkkeilys√§kki: 

Riku Mannonen: https://rikumannonen935063021.wordpress.com/

## a) Asenna Kali virtuaalikoneeseen

Ladataan [Kali](https://www.kali.org/get-kali/#kali-platforms)
Avataaan vmbox ja tehd√§√§n uusi kone ohjeiden mukaan. Seuraavat askeleet l√∂ytyv√§t [ohjeesta](https://www.kali.org/docs/installation/hard-disk-install/)

- Laitetaan koneelle nimi.
- Annettaan 4 CPU.
- Hard disk valittu ja voi valita sopivan koon sille.
- K√§ynnist√§ kone.
- Valitse installer.
- Kieleksi english
- Maaksi valitse other sitten europe sielt√§ finland.
- Configure locales valitsin UK, koska se oli l√§hinn√§ Suomea.
- Configure keyboard valitsin american english.
- Hostname kohdalla menin default arvolla ja continue.
- Domain name tyhj√§n√§ ja continue.
- Luodaan k√§ytt√§j√§.
- Partition disk kohdassa ohjeen mukaan "Guided - use the entire disk".
- Kaikki seuraavat vaiheet ohjeen mukaan oletusasetuksilla, kuten software selection.

Nyt kone on asennettu ja p√§√§st√§√§n sis√§lle.

![0](https://github.com/Viktorialissa/PenTest/assets/112398757/2f3ae157-3c17-4de3-885d-36ad1fa76b75)


![1](https://github.com/Viktorialissa/PenTest/assets/112398757/5f272560-309d-4996-b60e-5d8937d63128)

## b) Asenna Metasploitable 2 virtuaalikoneeseen

Latasin metasploitablen sivustolta:

https://docs.rapid7.com/metasploit/metasploitable-2/

Valittu versio oli t√§m√§:

https://sourceforge.net/projects/metasploitable/

Purin zip-tiedoston ja [videon](https://www.youtube.com/watch?v=vCs7gOkg7XI) ohjeiden mukaan yhdistin metasploitablen vmboxiin.

Avataan vmbox ja painetaan nappia New, josta p√§√§st√§√§n tekem√§√§n uusi kone. Valitaan tyypiksi Linux ja versioksi "Other Linux (64-bit)". Seuraavassa osiossa default asetukset cpu:hun ja muistiin ovat ok. Seuraavaksi valitaan virtual hard disk ja otetaan k√§ytt√∂√∂n vaihtoehto "Use an Existing Virtual Hard Disk File" ja lis√§t√§√§n Metasploitable hard drive painamalla ensin kansion kuvaa oikealla ja uudessai ikkunassa painetaan "Add". Nyt valitaan ladatusta kansiosta metasploitable ja avataan se. Sitten painetaan "choose" ja menn√§√§n eteenp√§in, kunnes painetaan "finish".

## c) Tee koneille virtuaaliverkko

Mene MS2 koneen *asetukset* valitse *network* valitse *host-only Adapter* ja paina *ok*.

![2](https://github.com/Viktorialissa/PenTest/assets/112398757/0d5c8a84-18ba-4a78-b718-c732bbca8c69)


Mene kalin asetuksiin ja valitse sielt√§ *network*. Paina *Adapter 2* ja t√§pp√§ kohtaan *Enable Network Adapter*. Valitse sinne *Host-only Adapter* ja *ok*. Adapter 1 on kiinnitetty NAT:iin.

![3](https://github.com/Viktorialissa/PenTest/assets/112398757/138e0c57-e46a-4ca4-9ebe-1c2fcbf6ac6b)

![4](https://github.com/Viktorialissa/PenTest/assets/112398757/bfac016b-7e4f-4d21-aa36-f0619de73fa4)

Avataan kali kone ja kirjoitetaan terminaaliin komento:
    
    ifconfig  

![5](https://github.com/Viktorialissa/PenTest/assets/112398757/3ae15c56-47c6-45a1-973b-e866532d8352)


Komento:

    ip a

![6](https://github.com/Viktorialissa/PenTest/assets/112398757/70277a1a-7cfc-42fa-9c5a-645a7e5ab5b2)


Host-only adapterin lis√§√§minen lis√§si eth1 yhteyden.

Komento:

```
	ping 1.1.1.1
```

![7](https://github.com/Viktorialissa/PenTest/assets/112398757/fe008c5e-5483-4f75-915c-598600fbca0c)



Komennot:

    ping www.google.com 
    
    curl www.google.com

![8](https://github.com/Viktorialissa/PenTest/assets/112398757/94fd9018-3e90-4748-871b-5c5e0171a985)


> Lopetus üìÜ 07.11.2023 üïí 19.00

> Aloitus üìÜ 08.11.2023 üïí 14.00 lopetus üïí 15.00 (luetaan eri artikkeleita)

> Aloitus uudelleen üìÜ 09.11.2023 üïí 14.00


## d) Etsi Metasploitable porttiskannaamalla

Sy√∂t√§n metasploitablen terminaaliin komennon:

        ifconfig

Komennon avulla saan selville metasploitablen ip-osoitteen, jota l√§hden kalista etsim√§√§n skannaamalla.


![10](https://github.com/Viktorialissa/PenTest/assets/112398757/5d13f1db-497c-4589-83d5-18eaa91f3e21)


Kalin terminaaliin sy√∂t√§n my√∂s komennon ``ifconfig``, jonka avulla saan tiet√§√§ oman koneeni ip-osoitteen my√∂s komento ``ip a`` on hyv√§ n√§ytt√§m√§√§n komennon.


Aloitetaan Kalissa Metsploitable frameworkin asennus, jotta voidaan k√§ytt√§√§ sit√§ kunnolla.

Laitetaan Kalissa komento:

        sudo msfdb init


![16](https://github.com/Viktorialissa/PenTest/assets/112398757/d95af316-c872-4dab-b8d5-f473c4d273fc)


Sen j√§lkeen laitetaan komento:

    sudo msfconsole

Avataan toinen terminaali kalissa ja laietaan komento:

    ip a

Katsotaan sielt√§, mik√§ ethernet yhteys on up ja otetaan sielt√§ ip-osoite. Toinen tapa t√§h√§n oli yll√§ mainittu ``ifconfig``. Laitetaan toisessa terminaalissa komento:

    db_nmap -sn <ip>-200

![17](https://github.com/Viktorialissa/PenTest/assets/112398757/4708678f-756c-4ded-95df-387b9f795dab)

![18](https://github.com/Viktorialissa/PenTest/assets/112398757/854ed59f-6df1-4f12-adaf-346df9193bf1)

Toinne ip-osoite l√∂ytyi ja t√§m√§ ei ole Kalin ip-osoite, joten se on varmaan metasploitablen.

Kopioidaan se ja menn√§√§n selaimeen tarkastelemaan. Sielt√§ se l√∂ytyi.

![9](https://github.com/Viktorialissa/PenTest/assets/112398757/91e78e28-c8b4-46ce-8039-d575c57a3e79)


## e) Porttiskannaa Metasploitable huolellisesti (db_nmap -A -p0-). Analysoi tulos.

Metasploitablen ip-osoite saatiin edellisess√§ teht√§v√§ss√§.
Laitetaan komento terminaaliin:

        db_nmap -A -p0- 192.168.56.102

Saadaan aika pitk√§ skannausraportti

![19](https://github.com/Viktorialissa/PenTest/assets/112398757/94afb97d-5d62-4233-9721-46102d3c034b)

![20](https://github.com/Viktorialissa/PenTest/assets/112398757/a770ce22-c478-4a06-805d-830f3955facb)

![21](https://github.com/Viktorialissa/PenTest/assets/112398757/3a990bc7-b161-4d71-b771-b9b3e004f7ad)

Se on aika laaja ja kertoo tarkasti eri portteja, jotka on auki ja mit√§ niiss√§ py√∂rii. Tieota oli runsaasti sek√§ versionumeroita palveluista avoimissa porteissa.

Kirjoitin viel√§ komennon:

    hosts

T√§st√§ n√§en Kaikki hostit, jotka olen skannannut.

![22](https://github.com/Viktorialissa/PenTest/assets/112398757/ec6b154c-ee6b-4b23-a836-7033dea502ed)

## f) Murtaudu Metasploitablen VsFtpd-palveluun Metasploitilla

Kirjoitin terminaaliin komennon:

    search vsftpd


![23](https://github.com/Viktorialissa/PenTest/assets/112398757/6c63f33e-6be4-44d6-a196-9df6e164dcf4)


Sain raportin, joka kertoo matching modules:sta. Toisessa niist√§ lukee backdoor, joten valitaan se, koska vaikuttaa silt√§, ett√§ siin√§ voisi olla haavoittuvuus.

Kirjoitetaan terminaaliin komento:

    use 1

![24](https://github.com/Viktorialissa/PenTest/assets/112398757/d8bd716c-0510-4cb5-9bdb-f35926db3713)

Laitoin seuraavaksi metasploitablen ip-osoitteen komentoon:

    set RHOSTS 192.168.56.102

Seuraavaksi kirjoitan komennon:

    exploit

Ja seuraavaksi se l√∂yt√§√§ shellin ja avaa session.


![25](https://github.com/Viktorialissa/PenTest/assets/112398757/f1efddc6-80ad-4f58-9cc0-357b002fca27)


![27](https://github.com/Viktorialissa/PenTest/assets/112398757/a6d05a91-8d06-4b0b-9027-9f7de1738194)


Kirjoitan sinne viel√§ id, joka n√§ytt√§√§ minulla olevan nyt root-k√§ytt√§j√§n oikeudet.

Banner-kohdasta n√§kyy VsFTPd-palvelun versio (2.3.4).

USER-kohdassa pyydet√§√§n salasanaa ilmeisesti k√§ytt√§j√§lt√§ 331.

Backdoor service: Onnistuneen hy√∂kk√§yksen j√§lkeen on luotu taaksep√§in suunnattu ("backdoor") palvelu, jonka k√§sittely on aloitettu.

UID-kohdassa n√§kyy uid=0 (root) ja gid=0 (root).

Found shell viittaa siihen, ett√§ minulle on nyt p√§√§sy shelliin t√§m√§n Metasploit Frameworkin kautta.

Command shell session 1 opened eli istunto on avattu ja aika, jolloin se on avattu.



## g) Parempi sessio. Tee vsftpd-hy√∂kk√§yksest√§ saadusta sessiosta parempi. 

P√§ivitet√§√§n meterpreteriin kirjoittamalla komento:

    sessions -u 1


![30](https://github.com/Viktorialissa/PenTest/assets/112398757/1cd8b703-0d1c-456c-9ae6-165eacdd6f81)


  sessions

n√§kyy kaksi sessiota, joista toinen on meterpreter.

Kirjoitetaan komento:

    sessions 2

ja n√§in aukeaa shelliksi meterpreter.

![31](https://github.com/Viktorialissa/PenTest/assets/112398757/a115214c-67a0-43e8-b93d-63a3d16b5d49)


> Lopetus üìÜ 09.11.2023 üïí 16.49

> Aloitus üìÜ 11.11.2023 üïí 11.00


## h) Etsi, tutki ja kuvaile jokin hy√∂kk√§ys ExploitDB:sta. 

EXPLOIT DATABASE https://www.exploit-db.com/exploits/51695

User Registration & Login and User Management System v3.0 - SQL Injection (Unauthenticated)

Tietoturvaan liittyv√§ Proof of Concept SQL-injektiohy√∂kk√§ys.

Kommenteissa on hy√∂kk√§yksen nimi (User Registration & Login and User Management System v3.0 - SQL Injection (Unauthenticated)), p√§iv√§m√§√§r√§ (19/08/2023), hy√∂kk√§yksen tekij√§ (Ashutosh Singh Umath), kotisivu (https://phpgurukul.com), ohjelmiston latauslinkki, versio (3.0), testattu k√§ytt√∂j√§rjestelm√§ (Windows 11)

Hy√∂kk√§yksess√§ ensin navigoidaan admin sis√§√§nkirjautumissivulle ja sy√∂tt√§√§ admin-k√§ytt√§j√§nimen kentt√§√§n komento:

	*admin' -- -*

Sek√§ jokin satunnainen salasana salasanakentt√§√§n.

T√§m√§n j√§lkeen on onnistuneesti kirjauduttu sis√§√§n adminina.

Seuraavat vaiheet kertovat, kuinka kaikki tieto voidaan ladata tietokannasta:

	> Vaihe 4.1: Kirjaudu admin-ohjauspaneeliin ja 	tallenna verkkopyynt√∂.

	> Vaihe 4.2: Kopioi tallennettu pyynt√∂ tiedostoon.

	> Vaihe 4.3: K√§yt√§ seuraavaa komentoa saadaksesi kaiken saatavilla olevan tiedon tietokannasta, jossa haavoittuvuus on:

	      sqlmap -r <tiedostonimi> -p username -D loginsystem 	--dump-all

	<tiedostonimi> on tallennetun pyynn√∂n tiedostonimi.

T√§m√§ hy√∂kk√§ys n√§ytt√§√§, ett√§ admin-kirjautumisessa on SQL-injektiohaavoittuvuus. Haavoittuvuutta k√§ytt√§en hy√∂kk√§j√§ voi kirjautua sis√§√§n adminina ja suorittaa tietokannassa SQL-komentoja k√§ytt√§en sqlmappia ty√∂kaluna. 


## i) Etsi, tutki ja kuvaile hy√∂kk√§ys 'searchsploit' -komennolla. Muista p√§ivitt√§√§.

Kirjoitin komennon:

    searchsploit -u

T√§m√§ p√§ivitti searchsploitin.


![39](https://github.com/Viktorialissa/PenTest/assets/112398757/6d882129-819a-4802-9504-7d3f7d18a914)


Sen j√§lkeen kirjoitin komennon:

    searchsploit wordpress

    
![40](https://github.com/Viktorialissa/PenTest/assets/112398757/4bbef9bf-da14-48c4-ac06-d99fb04c6b4f)


Sitten valitsin sielt√§ summan mutikassa jonkun ja avasin sen komennolla:

    cat /usr/share/exploitdb/exploits/php/webapps/47436.txt


![41](https://github.com/Viktorialissa/PenTest/assets/112398757/f53172b5-5277-4434-9264-edc61c7d3d8e)

Kyseess√§ on WorPress-teeman "Zone Real Estate" haavoittuvuus liittyen XSS-hy√∂kk√§ykseen. Hy√∂kk√§yksen on tehnyt m0ze. Haavoittuvuuden versio on 4.11 ja sit√§ on testattu Parrot OS  k√§ytt√∂j√§rjestelm√§ll√§

Haavoittuvuus mahdollistaa pysyv√§n XSS-hy√∂kk√§yksen.
Ensin luodaan uusi agenttitili sitten sinut uudelleenohjataan nettisivulle. Voit upottaa oman haittakoodisi Address-kent√§ss√§. T√§ll√§ voi varastaa ev√§steit√§.

Seuraavassa kohdassa voit poistaa mink√§ tahansa sivun tai postauksen muokkaamalla "data-propertyid"-kohtaa.

## j) Kokeile vapaavalintaista haavoittuvuusskanneria johonkin Metasploitablen palveluun. 

Valitaan Nikto, joka on avoimen l√§hdekoodin skannausohjelma. Se on suunniteltu tunnistamaan ja raportoimaan mahdollisia tietoturvaongelmia verkkosivuilla. Komennossa nikto -h tarkoittaa -h sanaa host. Eli komento suoritetaan kyseiselle is√§nt√§osoitteelle, joka t√§ss√§ tapauksessa on metasploitablen ip-osoite. Komento pyyt√§√§ Niktoa tarkistamaan ip-osoitteessa olevia tietoturva-aukkoja tai muita haavoittuvuuksia.

Aloitetaan p√§ivitt√§m√§ll√§ kone:

    sudo apt-get update
    sudo apt-get upgrade

Asennetaan nikto:

    sudo apt-get install nikto

Kohdennetaan metasploitableen komennolla:

    nikto -h 192.168.56.102

Saadaan tulos


![34](https://github.com/Viktorialissa/PenTest/assets/112398757/8a218bf9-ae5d-4cc3-9001-1d5adcd63013)

![35](https://github.com/Viktorialissa/PenTest/assets/112398757/85447034-16f3-4bf9-a467-88c8259f2f64)


## k) Kokeile jotain itsellesi uutta ty√∂kalua, joka mainittiin x-kohdan l√§pik√§velyohjeessa.

Kokeilin feroxbusteria ja k√§ytin kohteena metasploitablea. Asensin ensin feroxbusterin komennolla:

    sudo apt-get install feroxbuster

Sitten katkaisin nettiyhteyden, mutta pingasin metaslpoitablea varmistaakseni yhteyden koneiden v√§lill√§. Pingasin my√∂s googlea varmistaakseni, ett√§ nettiyhteys on poikki.


![36](https://github.com/Viktorialissa/PenTest/assets/112398757/5047e7a3-ce13-4c8d-8b48-0077bd2c41a8)

Kirjoitin terminaaliin komennon:

    feroxbuster -u http://192.168.56.102

Tulostus kesti hyvin pitk√§√§n ja sielt√§ tuli eritt√§in paljon tavaraa. Feroxbuster suorittaa hakemistohy√∂kk√§yksen etsien piilotettuja tiedostoja ja kansioita sek√§ haavoittuvuuksia, joten t√§st√§ syyst√§ my√∂s tavaraa tuli √§√§rimm√§isen paljon. Hakemistoja etsin metasploitablen osoitteesta, jota pingasin aikaisemmin. 


![37](https://github.com/Viktorialissa/PenTest/assets/112398757/6fdabcc9-cd11-4d77-aa62-a5263a20e02a)


Hakemistoja l√∂ytyi 245 sek√§ 250,111 virhett√§ tai ongelmaa sivustolta.
Tulokset ovat j√§rjestyksess√§ ajan mukaan ja eri hakemistoje mukaan. Esim feroxbuster on tarkistanut ``http://192.168.56.102/mutillidae/styles/ddsmoothmenu/`` -osoitteen ja l√∂yt√§nyt sielt√§ 245 hakemistoa. My√∂s muita kohteita l√∂ytyi, kuten ``http://192.168.56.102/phpMyAdmin/, http://192.168.56.102/twiki/, http://192.168.56.102/dvwa/``


![38](https://github.com/Viktorialissa/PenTest/assets/112398757/1c537de3-97be-4ef5-8604-40c93f68ea50)

> Lopetus üìÜ 11.11.2023 üïí 19.10.


## L√§hteet:

- [Exploit Database - User Registration & Login and User Management System v3.0 - SQL Injection (Unauthenticated)]( https://www.exploit-db.com/exploits/51695). Luettu 11.11.2023.
- [Exploit Database - Searchsploit-The Manual](https://www.exploit-db.com/searchsploit). Luettu 11.11.2023.
- [HTB: Mirai](https://0xdf.gitlab.io/2022/05/18/htb-mirai.html). Luettu 11.11.2023.
- [Kali](https://www.kali.org/get-kali/#kali-platforms). Luettu 07.11.2023.
- [Kali - Installing Kali Linux](https://www.kali.org/docs/installation/hard-disk-install/). Luettu 07.11.2023.
- [Kali - Nikto](https://www.kali.org/tools/nikto/). Luettu 11.11.2023.
- [Medium - Discover Hidden Directories and Files with Feroxbuster: The Ultimate Web Enumeration Tool [Cheat Sheet]](https://medium.com/@cuncis/discover-hidden-directories-and-files-with-feroxbuster-the-ultimate-web-enumeration-tool-cheat-cb55b033baa9). Luettu 11.11.2023.
- [Medium - Metasploit: Upgrade Normal Shell To Meterpreter Shell](https://infosecwriteups.com/metasploit-upgrade-normal-shell-to-meterpreter-shell-2f09be895646). Luettu 07.11.2023.
- [Rapid7 - Metasploitable 2](https://docs.rapid7.com/metasploit/metasploitable-2/). Luettu 07.11.2023.
- [Riku Mannonen - Nyrkkeilys√§kki](https://rikumannonen935063021.wordpress.com/). Luettu 07.11.2023.
- Tero Karvinen luento 06.11.2023.
- [Tero Karvinen - teht√§v√§](https://terokarvinen.com/2023/eettinen-hakkerointi-2023/#h3-lab-kid). Luettu 07.11.2023.
- [YouTube - How To Install Metasploitable 2 In VirtualBox - Home Hacking Lab Video 4](https://www.youtube.com/watch?v=vCs7gOkg7XI). Katsottu 07.11.2023.


