#### Alisa Ahokas

Aloitetaan tehtävän tekeminen 24.11.2023 klo 15.00

# x) Lue ja tiivistä. 

### [Karvinen 2016: PostgreSQL Install and One Table Database – SQL CRUD tutorial for Ubuntu](https://terokarvinen.com/2016/03/05/postgresql-install-and-one-table-database-sql-crud-tutorial-for-ubuntu/)

Aloitetaan kohdasta: Three line install

sudo apt-get update aina ennen kuin asennetaan mitään.

PostgreSQL asennus, demonin potkaisu, tietokannan luonti, käyttäjän luonti.

```
$ sudo apt-get -y install postgresql
$ sudo systemctl start postgresql
$ sudo -u postgres createdb $(whoami)
$ sudo -u postgres createuser $(whoami)
```

Käynnistetään tietokanta:

    $ psql

Tietokannassa saa apua käyttämällä monesti backslashiä eli \

Kirjoittamalla myös help sekä lopetus q tait \q

*CRUD*

CREATE:

Luodaan taulu antamalla sille nimi, sekä id astetaan pääavaimeksi. Toisena attribuuttina annetaan tässä esimerkiksi nimi, joka voi olla pituudeltaan 200 merkkiä.

```
CREATE TABLE <table name> (id SERIAL PRIMARY KEY, name VARCHAR(200));
CREATE TABLE
```

Luotuun tauluun lisätään tietoa. Kerrotaan taulu, johon lisäys tulee sekä attribuutti ja annetaan attribuutille arvo.

```
INSERT INTO <table name>(name) VALUES ('Attribute value');
INSERT 0 1
```

READ:

Luetaan taulusta tietoa, joka voidaan tekemällä SELECT eli valitaan * = kaikki ja kerrotaan taulun nimi, josta halutaan saada kaikki attribuutit arvoineen näkyviin.

    SELECT * FROM <table name>;

UPDATE:

Päivitetään taulussa. Valitaan taulu, jota päivittäminen koskee ja asetetaan uusi arvo ja viitataan attribuuttiin sekä vanhaan arvoon, joka muutetaan.

```
UPDATE <table name> SET name='New value' WHERE name='Attribute value';
UPDATE 1
```

DELETE:

Poistaminen tapahtuu kirjoittamalla Delete valitusta taulusta, josta osoitetaan attribuutti arvoineen.

```
DELETE FROM <table name> WHERE name='Attribute value';
DELETE 1
```

Tarkistetaan poisto valitsemalla kaikki taulusta.

    SELECT * FROM <table name>;

### [OWASP 2017: A1:2017-Injection](https://owasp.org/www-project-top-ten/2017/A1_2017-Injection)

Melkin mikä tahansa datan lähde voi toimia injenktion vektorina, kuten paramteri, ympäristömuuttuja, ulkoinen/sisäinen web palvelu.

Haavoittuvuuksia löytyy monesti SQL:ssä, ORM kyselyissä, OS komennoissa, NoSQL kysylyissä, XML parsereissa jne. Skannerit ja fuzzerit auttavat haavoittuvuuksien löytymisessä. 

Injektiot voviat johtaa datahävikkiin, korruptioon tai dataa päätyä vääriin käsiin, jotka eivät ole oikeutettuja siihen.

Sovellus on haavoittuvainen hyökkäykselle esimerkiksi käyttäjän syöttämä data ei ole sovelluksen puolelta validoitu tai filtteröity. Vihamielinen data konkatenoidaan tai käytetään suoraan esim. SQL komennon yhteydessä.

Injektioita voidaan ennaltaehkäistä pitämällä data erillään kyselyistä ja komennoista. Turvallinen API rajapinta, jotta vältetään tulkin käyttöä kokonaan tai tarjotaan parametrisoitu rajapinta.

### [PortSwigger Academy: SQL injection](https://portswigger.net/web-security/sql-injection/cheat-sheet)

SQL injektio eli SQLi on haavoittuvuus, joka mahdollistaa hyökkääjän puuttua kyselyihin, joita sovellus tekee tietokantaansa. Tämä mahdollistaa datan liiallisen paljastumisen hyökkääjälle. Hyökkääjä voi saada käsiinsä esimerkiksi salasanoja, luottokorttien tietoja jne.

Haavvoittuvuuksia voi havaita systemaattisesti testaamalla sovellusta. Voit käyttää erilaisia keinoja kuten boolean ehtoja, payloadeja...

Suurin osa SQL injektioista tapahtuu kättämällä where-lauseen select-kyselyä.

Hyökkääjä yrittää löytää piilotettua dataa, kumota sovelluslogiikkaa, käyttää union-hyökkäyksiä saadakseen yhteyden tietokantaan.

# a) CRUD

Tehdään Tero Karvisen [artikkelin](https://terokarvinen.com/2016/03/05/postgresql-install-and-one-table-database-sql-crud-tutorial-for-ubuntu/) ohjeiden mukaan.

Aloitetaan päivittämällä.

    $ sudo apt-get update

Asennetaan postgresql

    $ sudo apt-get -y install postgresql

Käynnistetään tietokanta

    $ sudo systemctl start postgresql

Luodaan tietokanta

    $ sudo -u postgres createdb alisa

Tämän jälkeen terminaalissa luki

![0](https://github.com/Viktorialissa/PenTest/assets/112398757/902b0b81-43b8-4049-a110-4b59df0d647f)


En oikein tiedä, mitä tehdä niin katson käyttäjän alisa oikeudet ja sitten löysin [artikkelin](https://docs.mattermost.com/install/install-ubuntu-1804-postgresql.html), jonka komentoja ajattelin testailla.

Käytin komentoa

    sudo --login --user postgres

![1](https://github.com/Viktorialissa/PenTest/assets/112398757/f6b2aecb-3caf-4ef0-8896-6a4578a0c758)


Sitten käytin komentoa

    psql

Ja jatkoni artikkelin ohjeiden mukaan laittamalla komennon: 

    CREATE DATABASE name;

Ja sain tietää, että aikaisemmin luomani database on jo tehty. Peruutetaan tästä ja yritetään miettiä hetki. Noh jatkan Teron artikkelien ohjeiden mukaan kerta siellä oli jo tietokanta...

![2 0](https://github.com/Viktorialissa/PenTest/assets/112398757/00ef53db-30dd-45a8-8b8f-ee69aa213424)

Luodaan käyttäjä:

    $ sudo -u postgres createuser alisa

Saadaan samantyylinen viesti kuin aikaisemmin.

![3](https://github.com/Viktorialissa/PenTest/assets/112398757/a348caa2-e593-45fc-9858-fb66a7e8c801)


Laitoin komennon

    psql

Ja pääsin tietokantaan. En oikein tiedä, mitä tuossa ylempänä tapahtui. Jatketaan eteenpäin siitä huolimatta.

Käytetään komentoa

```
alisa=> CREATE TABLE animals (id SERIAL PRIMARY KEY, name VARCHAR(200));
CREATE TABLE
```

Tämä ei nyt toiminut. Palataan artikkelin pariin.

![6](https://github.com/Viktorialissa/PenTest/assets/112398757/d40ed5f9-8a04-4e43-a1ca-c2e729a20be5)


Tämäkään ei nyt ihan lähtenyt toimimaan. Kävin muokkaamassa  sudo ``nano /etc/postgresql/16/main/pg_hba.conf``
artikkelin ohjeen mukaan ja en saanut toimimaan. Valittaa aina, jos yrittää luoda taulun `` "ERROR:  permission denied for schema public" ``

Alta voi katsoa koko sekoilun:

<details>

<summary>Kuvasarja</summary>

![13](https://github.com/Viktorialissa/PenTest/assets/112398757/bd6dd78b-5592-4809-9a95-686bbf7ff815)
![14](https://github.com/Viktorialissa/PenTest/assets/112398757/49438e47-fe83-4399-9c97-8256f87af1bc)
![15](https://github.com/Viktorialissa/PenTest/assets/112398757/96607cbb-f64f-4fa6-ad3d-c8bf82ff6dfa)
![16](https://github.com/Viktorialissa/PenTest/assets/112398757/d764d429-8108-4310-bac6-00326dc23ea2)
![17](https://github.com/Viktorialissa/PenTest/assets/112398757/be646b54-4aea-4cd6-92f3-25856af3773a)
![18](https://github.com/Viktorialissa/PenTest/assets/112398757/060a1f8b-a9d0-4673-b89b-fa9b5a61a35b)
![19](https://github.com/Viktorialissa/PenTest/assets/112398757/ab353250-e82d-4688-bd07-4b8fc81d01dd)

</details>

Lopulta päätin mennä juureen ja kokeilla sieltä onnistunko tekemään mitään vai jatkanko eteenpäin.
Siellä onnistuin luomaan taulun animals ja jatkan tehtävää eteenpäin, vaikka se ei nyt mennyt ehkä tehtävänannon mukaan täysin.

![20](https://github.com/Viktorialissa/PenTest/assets/112398757/7ab2d92a-8bbd-44bf-87b8-77fd82a8ed2b)


INSERT & SELECT

Create-osuudessa INSERT asettaa tietoa tietokantaan ja SELECT lukee tietoa taulusta eli Read-osuus. 

    INSERT INTO animals (name) VALUES ('Cat');

Insert into animals kertoo, mihin tauluun tietoa lisätään ja suluissa oleva name kertoo sarakkeen ja sarakkeelle tulevan arvon (values) olevan kissa (cat). 

    SELECT * FROM animals

Tässä valitaan kaikki sarakkeet ja arvot taulusta animals.

![22](https://github.com/Viktorialissa/PenTest/assets/112398757/1648ab3b-e2f3-4ae3-9798-c3a4b288018c)

UPDATE 

Päivitetään tietoa Update lauseella, missä päivitetään animals taulua ja laitetaan nimi attribuutille arvo Tiikeri, kun arvo on ollut kissa.

    UPDATE animals SET name='Tiger' WHERE name='Cat';


![23](https://github.com/Viktorialissa/PenTest/assets/112398757/57847167-7d3b-458f-9d47-b279119d79a6)

DELETE

Tässä seuraavassa aluseessa poistetaan tietokannasta tietoa. Delete from animals kertoo, mistä taulusta tietoa halutaan poistaa ja where name kertoo poistettavan arvon.

    DELETE FROM animals WHERE name='Tiger';

![24](https://github.com/Viktorialissa/PenTest/assets/112398757/db43cfcf-7974-43a3-8681-10202094d85a)



# b) SQLi me

Tehdään SQL-injektio, jossa lisätään kommenttina --OR 1=1 eli valinta on aina totta.

```
SELECT * FROM animals WHERE name='' OR 1=1;
SELECT * FROM animals WHERE name='Parrot' OR 1=1;
```

![26](https://github.com/Viktorialissa/PenTest/assets/112398757/4a837b08-ccb3-4d7f-b976-a573cd8e2b8c)


# PortSwigger Labs

## c)  SQL injection vulnerability in WHERE clause allowing retrieval of hidden data

Tehtävä löytyy (h1-rportista)[https://github.com/Viktorialissa/PenTest/blob/main/h1.md#ratkaise-portSwigger-labs-teht%C3%A4v%C3%A4]

## d)  SQL injection vulnerability allowing login bypass

Tehtävänanto kertoo, että tulee kirjautua sisään käyttäjänimellä administrator. Tehdään siis SQL-injektio, jotta saadaan ohitettua sisäänkirjautuminen ilman oikeita tunnuksia. 

![28](https://github.com/Viktorialissa/PenTest/assets/112398757/0a042ff5-20b9-4104-8683-9f3af2b1187c)

![29](https://github.com/Viktorialissa/PenTest/assets/112398757/0d7a4b3c-813f-4d7b-ac73-ea845c3f26eb)


Tehtävä ratkeaa laittamalla administrator'--
Tässä administrator oli käyttäjätunnus ja '-- aiheutti sen, että salasana pystyttiin ohittamaan. -- tarkoitti SQL:ssä kommenttia. Laitoin salasanaksi 1 ja tällä pääsin eteenpäin.

## e) SQL injection attack, querying the database type and version on Oracle

Avataan zap. Tehtävänanto kertoo, että haavoittuvuus on kategoria filtterissä. Valitaan jokin aktegoria ja otetaan zapista oikea get-pyyntö. Tässä hieman mietin, mutta oli pakko käyttää tehtävänannon yhteydessä olevaa apua.
Tämä lisää kaksi 'abs' ja 'def' sarakkeet koodiin.

![30](https://github.com/Viktorialissa/PenTest/assets/112398757/4c6fbd66-fc12-487b-9272-f6fcd50fdf8b)

Kokeillaan jatkaa ohjeiden mukaan.

![31](https://github.com/Viktorialissa/PenTest/assets/112398757/07b83549-76b0-4cbd-a07d-c6e2e12b7bf9)

![32](https://github.com/Viktorialissa/PenTest/assets/112398757/501a5ae4-2683-4077-8182-49dd685ed59a)

Tehtävä rakteaa, mutta en olisi osannut tehdä sitä ilman solution kohtaa. Täytyisi melkein tehdä tehtävät uudelleen, jotta niitä voisi tarkastella erilaisin silmin.

## f) SQL injection attack, querying the database type and version on MySQL and Microsoft

Kategoria filtterissä on haavoittuvuus, jota hyväksikäyttäen tulisi ratkaista tehtävä eli tietokannan tyyppi ja versio. Yritin lähteä tarjotun [cheat sheetin](https://portswigger.net/web-security/sql-injection/cheat-sheet) avulla liikkeelle, mutta jouduin lopulta ihmettelyn jälkeen turvautumaan solution-kohtaan.

![33](https://github.com/Viktorialissa/PenTest/assets/112398757/a21e819f-5e96-4dba-aa54-2390ee5248cb)

![34](https://github.com/Viktorialissa/PenTest/assets/112398757/eed86d46-d1e9-4e6d-a6d5-f640bb20da15)


## g) SQL injection attack, listing the database contents on non-Oracle databases

Tässä tehtävässä haluttiin saada esille taulu, jossa on käyttäjätunnukset sekä salasanat. Haavoittuvuus on kategoria filtterissä. Tämän tehtävän tekemiseen minulla meni eniten aikaa, koska yritin tehdä tätä mahdollisimman pitkälle itse ilman solution-kohtaa. Lopulta käytin solution-kohtaa, mutta yritin olla käyttämättä kaikkia niitä suoraan ja sainkin monta 500 internal server erroria, kunnes löysin haluamani tiedot.

![g_users](https://github.com/Viktorialissa/PenTest/assets/112398757/ddec5f70-ec42-4a0c-b021-42cba7acbed9)

![g_salis](https://github.com/Viktorialissa/PenTest/assets/112398757/a291049b-f95c-4328-8574-d9ff1d444d17)

![g_tunnarit](https://github.com/Viktorialissa/PenTest/assets/112398757/8f230b82-48a9-4b14-a8ac-7f120c247296)

![g_solved](https://github.com/Viktorialissa/PenTest/assets/112398757/cbd5d846-a145-4d08-96d6-b506f774fcbb)


## h) SQL injection UNION attack, determining the number of columns returned by the query

Kategoria filtterin haavoittuvuuden avulla tulisi saada tehtävä ratkaistua. Tässä halutaan hyökkäyksen avulla saada kyselystä sarakkeiden määrä. Tässäkin jouduin käyttämään solution-osaa hieman avuksi.

![h_eka](https://github.com/Viktorialissa/PenTest/assets/112398757/d7722ad6-6e36-46fa-95e1-f18cd417ee6e)

![h_toka](https://github.com/Viktorialissa/PenTest/assets/112398757/48d2d9f1-7b2b-43d5-9237-2863f31221c4)

![h_kolmas](https://github.com/Viktorialissa/PenTest/assets/112398757/ed2c4a05-422a-49df-b8ba-703b5bc4e54e)

![h_neljas](https://github.com/Viktorialissa/PenTest/assets/112398757/acde0d33-27b5-496b-84e7-89ae5b948f29)

## i) SQL injection UNION attack, retrieving data from other tables

Tässä haavoittuvuus on jälleen kategoria filtterissä. Tehtävässä halutaan kyselyn avulla saada käyttäjätunnukset aj salasanat haltuun.
Lähetetään pyyntö ja saadaan vastauksena salasana.

39![39](https://github.com/Viktorialissa/PenTest/assets/112398757/be1ac99b-d6c8-4848-be35-c729e8bb7e51)

Päästään kirjautumaan sisään.

40![40](https://github.com/Viktorialissa/PenTest/assets/112398757/5b22f031-0ce7-4dfb-97f1-7c38339262ab)

41![41](https://github.com/Viktorialissa/PenTest/assets/112398757/c40d8d06-b480-4524-9d9f-0123bc4b766a)


## j) SQL injection UNION attack, retrieving multiple values in a single column

Tehtävässä halutaan useita arvoja samalle sarakkeelle kyselyn avulla. Haavoittuvuus on kategoria filtterissä. Tässä kohdassa jouduin myös käyttämään solution-kohtaa, koska jäin jumiin ja en päässyt eteenpäin. Lopulta tehtävä ratkesi.

![42](https://github.com/Viktorialissa/PenTest/assets/112398757/aeb1d450-7539-447f-8e2f-4366fd785732)

![43](https://github.com/Viktorialissa/PenTest/assets/112398757/d9b46b27-aa91-46a1-a167-61ddfd448882)

![44](https://github.com/Viktorialissa/PenTest/assets/112398757/bd0107d7-49ea-4be0-a318-5d9fdefa1f28)



Lopetetaan 📆 24.11.2023 🕐 21.00, koska koulusta heitettiin ulos.
Jatketaan raportin tekoa 📆 24.11.2023 🕐 22.30-23.55.
Jatketaan raportin tekoa 📆 25.11.2023 🕐 10.30-13.10. Pitää lähteä välillä töihin.
