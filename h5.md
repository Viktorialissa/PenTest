#### Alisa Ahokas

Aloitetaan teht√§v√§n tekeminen 24.11.2023 klo 15.00

# x) Lue ja tiivist√§. 

### [Karvinen 2016: PostgreSQL Install and One Table Database ‚Äì SQL CRUD tutorial for Ubuntu](https://terokarvinen.com/2016/03/05/postgresql-install-and-one-table-database-sql-crud-tutorial-for-ubuntu/)

Aloitetaan kohdasta: Three line install

sudo apt-get update aina ennen kuin asennetaan mit√§√§n.

PostgreSQL asennus, demonin potkaisu, tietokannan luonti, k√§ytt√§j√§n luonti.

```
$ sudo apt-get -y install postgresql
$ sudo systemctl start postgresql
$ sudo -u postgres createdb $(whoami)
$ sudo -u postgres createuser $(whoami)
```

K√§ynnistet√§√§n tietokanta:

    $ psql

Tietokannassa saa apua k√§ytt√§m√§ll√§ monesti backslashi√§ eli \

Kirjoittamalla my√∂s help sek√§ lopetus q tait \q

*CRUD*

CREATE:

Luodaan taulu antamalla sille nimi, sek√§ id astetaan p√§√§avaimeksi. Toisena attribuuttina annetaan t√§ss√§ esimerkiksi nimi, joka voi olla pituudeltaan 200 merkki√§.

```
CREATE TABLE <table name> (id SERIAL PRIMARY KEY, name VARCHAR(200));
CREATE TABLE
```

Luotuun tauluun lis√§t√§√§n tietoa. Kerrotaan taulu, johon lis√§ys tulee sek√§ attribuutti ja annetaan attribuutille arvo.

```
INSERT INTO <table name>(name) VALUES ('Attribute value');
INSERT 0 1
```

READ:

Luetaan taulusta tietoa, joka voidaan tekem√§ll√§ SELECT eli valitaan * = kaikki ja kerrotaan taulun nimi, josta halutaan saada kaikki attribuutit arvoineen n√§kyviin.

    SELECT * FROM <table name>;

UPDATE:

P√§ivitet√§√§n taulussa. Valitaan taulu, jota p√§ivitt√§minen koskee ja asetetaan uusi arvo ja viitataan attribuuttiin sek√§ vanhaan arvoon, joka muutetaan.

```
UPDATE <table name> SET name='New value' WHERE name='Attribute value';
UPDATE 1
```

DELETE:

Poistaminen tapahtuu kirjoittamalla Delete valitusta taulusta, josta osoitetaan attribuutti arvoineen.

```
DELETE FROM <table name> WHERE name='Attribute value';
DELETE 1
```

Tarkistetaan poisto valitsemalla kaikki taulusta.

    SELECT * FROM <table name>;

### [OWASP 2017: A1:2017-Injection](https://owasp.org/www-project-top-ten/2017/A1_2017-Injection)

Melkin mik√§ tahansa datan l√§hde voi toimia injenktion vektorina, kuten paramteri, ymp√§rist√∂muuttuja, ulkoinen/sis√§inen web palvelu.

Haavoittuvuuksia l√∂ytyy monesti SQL:ss√§, ORM kyselyiss√§, OS komennoissa, NoSQL kysylyiss√§, XML parsereissa jne. Skannerit ja fuzzerit auttavat haavoittuvuuksien l√∂ytymisess√§. 

Injektiot voviat johtaa datah√§vikkiin, korruptioon tai dataa p√§√§ty√§ v√§√§riin k√§siin, jotka eiv√§t ole oikeutettuja siihen.

Sovellus on haavoittuvainen hy√∂kk√§ykselle esimerkiksi k√§ytt√§j√§n sy√∂tt√§m√§ data ei ole sovelluksen puolelta validoitu tai filtter√∂ity. Vihamielinen data konkatenoidaan tai k√§ytet√§√§n suoraan esim. SQL komennon yhteydess√§.

Injektioita voidaan ennaltaehk√§ist√§ pit√§m√§ll√§ data erill√§√§n kyselyist√§ ja komennoista. Turvallinen API rajapinta, jotta v√§ltet√§√§n tulkin k√§ytt√∂√§ kokonaan tai tarjotaan parametrisoitu rajapinta.

### [PortSwigger Academy: SQL injection](https://portswigger.net/web-security/sql-injection/cheat-sheet)

SQL injektio eli SQLi on haavoittuvuus, joka mahdollistaa hy√∂kk√§√§j√§n puuttua kyselyihin, joita sovellus tekee tietokantaansa. T√§m√§ mahdollistaa datan liiallisen paljastumisen hy√∂kk√§√§j√§lle. Hy√∂kk√§√§j√§ voi saada k√§siins√§ esimerkiksi salasanoja, luottokorttien tietoja jne.

Haavvoittuvuuksia voi havaita systemaattisesti testaamalla sovellusta. Voit k√§ytt√§√§ erilaisia keinoja kuten boolean ehtoja, payloadeja...

Suurin osa SQL injektioista tapahtuu k√§tt√§m√§ll√§ where-lauseen select-kysely√§.

Hy√∂kk√§√§j√§ yritt√§√§ l√∂yt√§√§ piilotettua dataa, kumota sovelluslogiikkaa, k√§ytt√§√§ union-hy√∂kk√§yksi√§ saadakseen yhteyden tietokantaan.

# a) CRUD

Tehd√§√§n Tero Karvisen [artikkelin](https://terokarvinen.com/2016/03/05/postgresql-install-and-one-table-database-sql-crud-tutorial-for-ubuntu/) ohjeiden mukaan.

Aloitetaan p√§ivitt√§m√§ll√§.

    $ sudo apt-get update

Asennetaan postgresql

    $ sudo apt-get -y install postgresql

K√§ynnistet√§√§n tietokanta

    $ sudo systemctl start postgresql

Luodaan tietokanta

    $ sudo -u postgres createdb alisa

T√§m√§n j√§lkeen terminaalissa luki

![0](https://github.com/Viktorialissa/PenTest/assets/112398757/902b0b81-43b8-4049-a110-4b59df0d647f)


En oikein tied√§, mit√§ tehd√§ niin katson k√§ytt√§j√§n alisa oikeudet ja sitten l√∂ysin [artikkelin](https://docs.mattermost.com/install/install-ubuntu-1804-postgresql.html), jonka komentoja ajattelin testailla.

K√§ytin komentoa

    sudo --login --user postgres

![1](https://github.com/Viktorialissa/PenTest/assets/112398757/f6b2aecb-3caf-4ef0-8896-6a4578a0c758)


Sitten k√§ytin komentoa

    psql

Ja jatkoni artikkelin ohjeiden mukaan laittamalla komennon: 

    CREATE DATABASE name;

Ja sain tiet√§√§, ett√§ aikaisemmin luomani database on jo tehty. Peruutetaan t√§st√§ ja yritet√§√§n mietti√§ hetki. Noh jatkan Teron artikkelien ohjeiden mukaan kerta siell√§ oli jo tietokanta...

![2 0](https://github.com/Viktorialissa/PenTest/assets/112398757/00ef53db-30dd-45a8-8b8f-ee69aa213424)

Luodaan k√§ytt√§j√§:

    $ sudo -u postgres createuser alisa

Saadaan samantyylinen viesti kuin aikaisemmin.

![3](https://github.com/Viktorialissa/PenTest/assets/112398757/a348caa2-e593-45fc-9858-fb66a7e8c801)


Laitoin komennon

    psql

Ja p√§√§sin tietokantaan. En oikein tied√§, mit√§ tuossa ylemp√§n√§ tapahtui. Jatketaan eteenp√§in siit√§ huolimatta.

K√§ytet√§√§n komentoa

```
alisa=> CREATE TABLE animals (id SERIAL PRIMARY KEY, name VARCHAR(200));
CREATE TABLE
```

T√§m√§ ei nyt toiminut. Palataan artikkelin pariin.

![6](https://github.com/Viktorialissa/PenTest/assets/112398757/d40ed5f9-8a04-4e43-a1ca-c2e729a20be5)


T√§m√§k√§√§n ei nyt ihan l√§htenyt toimimaan. K√§vin muokkaamassa  sudo ``nano /etc/postgresql/16/main/pg_hba.conf``
artikkelin ohjeen mukaan ja en saanut toimimaan. Valittaa aina, jos yritt√§√§ luoda taulun `` "ERROR:  permission denied for schema public" ``

Alta voi katsoa koko sekoilun:

<details>

<summary>Kuvasarja</summary>

![13](https://github.com/Viktorialissa/PenTest/assets/112398757/bd6dd78b-5592-4809-9a95-686bbf7ff815)
![14](https://github.com/Viktorialissa/PenTest/assets/112398757/49438e47-fe83-4399-9c97-8256f87af1bc)
![15](https://github.com/Viktorialissa/PenTest/assets/112398757/96607cbb-f64f-4fa6-ad3d-c8bf82ff6dfa)
![16](https://github.com/Viktorialissa/PenTest/assets/112398757/d764d429-8108-4310-bac6-00326dc23ea2)
![17](https://github.com/Viktorialissa/PenTest/assets/112398757/be646b54-4aea-4cd6-92f3-25856af3773a)
![18](https://github.com/Viktorialissa/PenTest/assets/112398757/060a1f8b-a9d0-4673-b89b-fa9b5a61a35b)
![19](https://github.com/Viktorialissa/PenTest/assets/112398757/ab353250-e82d-4688-bd07-4b8fc81d01dd)

</details>

Lopulta p√§√§tin menn√§ juureen ja kokeilla sielt√§ onnistunko tekem√§√§n mit√§√§n vai jatkanko eteenp√§in.
Siell√§ onnistuin luomaan taulun animals ja jatkan teht√§v√§√§ eteenp√§in, vaikka se ei nyt mennyt ehk√§ teht√§v√§nannon mukaan t√§ysin.

![20](https://github.com/Viktorialissa/PenTest/assets/112398757/7ab2d92a-8bbd-44bf-87b8-77fd82a8ed2b)


INSERT & SELECT

Create-osuudessa INSERT asettaa tietoa tietokantaan ja SELECT lukee tietoa taulusta eli Read-osuus. 

    INSERT INTO animals (name) VALUES ('Cat');

Insert into animals kertoo, mihin tauluun tietoa lis√§t√§√§n ja suluissa oleva name kertoo sarakkeen ja sarakkeelle tulevan arvon (values) olevan kissa (cat). 

    SELECT * FROM animals

T√§ss√§ valitaan kaikki sarakkeet ja arvot taulusta animals.

![22](https://github.com/Viktorialissa/PenTest/assets/112398757/1648ab3b-e2f3-4ae3-9798-c3a4b288018c)

UPDATE 

P√§ivitet√§√§n tietoa Update lauseella, miss√§ p√§ivitet√§√§n animals taulua ja laitetaan nimi attribuutille arvo Tiikeri, kun arvo on ollut kissa.

    UPDATE animals SET name='Tiger' WHERE name='Cat';


![23](https://github.com/Viktorialissa/PenTest/assets/112398757/57847167-7d3b-458f-9d47-b279119d79a6)

DELETE

T√§ss√§ seuraavassa aluseessa poistetaan tietokannasta tietoa. Delete from animals kertoo, mist√§ taulusta tietoa halutaan poistaa ja where name kertoo poistettavan arvon.

    DELETE FROM animals WHERE name='Tiger';

![24](https://github.com/Viktorialissa/PenTest/assets/112398757/db43cfcf-7974-43a3-8681-10202094d85a)



# b) SQLi me

Tehd√§√§n SQL-injektio, jossa lis√§t√§√§n kommenttina --OR 1=1 eli valinta on aina totta.

```
SELECT * FROM animals WHERE name='' OR 1=1;
SELECT * FROM animals WHERE name='Parrot' OR 1=1;
```

![26](https://github.com/Viktorialissa/PenTest/assets/112398757/4a837b08-ccb3-4d7f-b976-a573cd8e2b8c)


# PortSwigger Labs

## c)  SQL injection vulnerability in WHERE clause allowing retrieval of hidden data

Teht√§v√§ l√∂ytyy (h1-rportista)[https://github.com/Viktorialissa/PenTest/blob/main/h1.md#ratkaise-portSwigger-labs-teht%C3%A4v%C3%A4]

## d)  SQL injection vulnerability allowing login bypass

Teht√§v√§nanto kertoo, ett√§ tulee kirjautua sis√§√§n k√§ytt√§j√§nimell√§ administrator. Tehd√§√§n siis SQL-injektio, jotta saadaan ohitettua sis√§√§nkirjautuminen ilman oikeita tunnuksia. 

![28](https://github.com/Viktorialissa/PenTest/assets/112398757/0a042ff5-20b9-4104-8683-9f3af2b1187c)

![29](https://github.com/Viktorialissa/PenTest/assets/112398757/0d7a4b3c-813f-4d7b-ac73-ea845c3f26eb)


Teht√§v√§ ratkeaa laittamalla administrator'--
T√§ss√§ administrator oli k√§ytt√§j√§tunnus ja '-- aiheutti sen, ett√§ salasana pystyttiin ohittamaan. -- tarkoitti SQL:ss√§ kommenttia. Laitoin salasanaksi 1 ja t√§ll√§ p√§√§sin eteenp√§in.

## e) SQL injection attack, querying the database type and version on Oracle

Avataan zap. Teht√§v√§nanto kertoo, ett√§ haavoittuvuus on kategoria filtteriss√§. Valitaan jokin aktegoria ja otetaan zapista oikea get-pyynt√∂. T√§ss√§ hieman mietin, mutta oli pakko k√§ytt√§√§ teht√§v√§nannon yhteydess√§ olevaa apua.
T√§m√§ lis√§√§ kaksi 'abs' ja 'def' sarakkeet koodiin.

![30](https://github.com/Viktorialissa/PenTest/assets/112398757/4c6fbd66-fc12-487b-9272-f6fcd50fdf8b)

Kokeillaan jatkaa ohjeiden mukaan.

![31](https://github.com/Viktorialissa/PenTest/assets/112398757/07b83549-76b0-4cbd-a07d-c6e2e12b7bf9)

![32](https://github.com/Viktorialissa/PenTest/assets/112398757/501a5ae4-2683-4077-8182-49dd685ed59a)

Teht√§v√§ rakteaa, mutta en olisi osannut tehd√§ sit√§ ilman solution kohtaa. T√§ytyisi melkein tehd√§ teht√§v√§t uudelleen, jotta niit√§ voisi tarkastella erilaisin silmin.

## f) SQL injection attack, querying the database type and version on MySQL and Microsoft

Kategoria filtteriss√§ on haavoittuvuus, jota hyv√§ksik√§ytt√§en tulisi ratkaista teht√§v√§ eli tietokannan tyyppi ja versio. Yritin l√§hte√§ tarjotun [cheat sheetin](https://portswigger.net/web-security/sql-injection/cheat-sheet) avulla liikkeelle, mutta jouduin lopulta ihmettelyn j√§lkeen turvautumaan solution-kohtaan.

![33](https://github.com/Viktorialissa/PenTest/assets/112398757/a21e819f-5e96-4dba-aa54-2390ee5248cb)

![34](https://github.com/Viktorialissa/PenTest/assets/112398757/eed86d46-d1e9-4e6d-a6d5-f640bb20da15)


## g) SQL injection attack, listing the database contents on non-Oracle databases

T√§ss√§ teht√§v√§ss√§ haluttiin saada esille taulu, jossa on k√§ytt√§j√§tunnukset sek√§ salasanat. Haavoittuvuus on kategoria filtteriss√§. T√§m√§n teht√§v√§n tekemiseen minulla meni eniten aikaa, koska yritin tehd√§ t√§t√§ mahdollisimman pitk√§lle itse ilman solution-kohtaa. Lopulta k√§ytin solution-kohtaa, mutta yritin olla k√§ytt√§m√§tt√§ kaikkia niit√§ suoraan ja sainkin monta 500 internal server erroria, kunnes l√∂ysin haluamani tiedot.

![g_users](https://github.com/Viktorialissa/PenTest/assets/112398757/ddec5f70-ec42-4a0c-b021-42cba7acbed9)

![g_salis](https://github.com/Viktorialissa/PenTest/assets/112398757/a291049b-f95c-4328-8574-d9ff1d444d17)

![g_tunnarit](https://github.com/Viktorialissa/PenTest/assets/112398757/8f230b82-48a9-4b14-a8ac-7f120c247296)

![g_solved](https://github.com/Viktorialissa/PenTest/assets/112398757/cbd5d846-a145-4d08-96d6-b506f774fcbb)


## h) SQL injection UNION attack, determining the number of columns returned by the query

Kategoria filtterin haavoittuvuuden avulla tulisi saada teht√§v√§ ratkaistua. T√§ss√§ halutaan hy√∂kk√§yksen avulla saada kyselyst√§ sarakkeiden m√§√§r√§. T√§ss√§kin jouduin k√§ytt√§m√§√§n solution-osaa hieman avuksi.

![h_eka](https://github.com/Viktorialissa/PenTest/assets/112398757/d7722ad6-6e36-46fa-95e1-f18cd417ee6e)

![h_toka](https://github.com/Viktorialissa/PenTest/assets/112398757/48d2d9f1-7b2b-43d5-9237-2863f31221c4)

![h_kolmas](https://github.com/Viktorialissa/PenTest/assets/112398757/ed2c4a05-422a-49df-b8ba-703b5bc4e54e)

![h_neljas](https://github.com/Viktorialissa/PenTest/assets/112398757/acde0d33-27b5-496b-84e7-89ae5b948f29)

## i) SQL injection UNION attack, retrieving data from other tables

T√§ss√§ haavoittuvuus on j√§lleen kategoria filtteriss√§. Teht√§v√§ss√§ halutaan kyselyn avulla saada k√§ytt√§j√§tunnukset aj salasanat haltuun.
L√§hetet√§√§n pyynt√∂ ja saadaan vastauksena salasana.

39![39](https://github.com/Viktorialissa/PenTest/assets/112398757/be1ac99b-d6c8-4848-be35-c729e8bb7e51)

P√§√§st√§√§n kirjautumaan sis√§√§n.

40![40](https://github.com/Viktorialissa/PenTest/assets/112398757/5b22f031-0ce7-4dfb-97f1-7c38339262ab)

41![41](https://github.com/Viktorialissa/PenTest/assets/112398757/c40d8d06-b480-4524-9d9f-0123bc4b766a)


## j) SQL injection UNION attack, retrieving multiple values in a single column

Teht√§v√§ss√§ halutaan useita arvoja samalle sarakkeelle kyselyn avulla. Haavoittuvuus on kategoria filtteriss√§. T√§ss√§ kohdassa jouduin my√∂s k√§ytt√§m√§√§n solution-kohtaa, koska j√§in jumiin ja en p√§√§ssyt eteenp√§in. Lopulta teht√§v√§ ratkesi.

![42](https://github.com/Viktorialissa/PenTest/assets/112398757/aeb1d450-7539-447f-8e2f-4366fd785732)

![43](https://github.com/Viktorialissa/PenTest/assets/112398757/d9b46b27-aa91-46a1-a167-61ddfd448882)

![44](https://github.com/Viktorialissa/PenTest/assets/112398757/bd0107d7-49ea-4be0-a318-5d9fdefa1f28)



Lopetetaan üìÜ 24.11.2023 üïê 21.00, koska koulusta heitettiin ulos.
Jatketaan raportin tekoa üìÜ 24.11.2023 üïê 22.30-23.55.
Jatketaan raportin tekoa üìÜ 25.11.2023 üïê 10.30-13.10. Pit√§√§ l√§hte√§ v√§lill√§ t√∂ihin.
