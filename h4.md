#### Alisa Ahokas

# Totally Legit Sertificate
<!-- Up -->

#### Aloitetaan teht√§vien tekeminen üìÜ 15.11.2023 üïí 14.00 ja luetaan [teht√§v√§nanto](https://terokarvinen.com/2023/eettinen-hakkerointi-2023/#h4-totally-legit-sertificate).

# x) Lue ja tiivist√§

## [A01:2021 ‚Äì Broken Access Control](https://owasp.org/Top10/A01_2021-Broken_Access_Control/)

Access control eli p√§√§synhallinta kontrolloi k√§ytt√§jien toimia niin, ett√§ he eiv√§t voi toimia laajemmin kuin tarkoitettu. Userina toimiminen, vaikka ei ole kirjautunut edes sis√§√§n tai adminina toimininen, vaikka on vaan user. Yleisimpi√§ virheit√§ access controlissa on pienimpien oikeuksien periaatteen noudattamatta j√§ttt√§minen. URL parametrien  tai API pyynt√∂jen muokkaaminen johtaen access controlin ohittamiseen. API:in p√§√§seminen k√§siksi niin, ett√§ voi k√§ytt√§√§ POST, PUT ja DELETE. Metadatan manipulointi k√§ytt√§en hyv√§ksi JWT tai cookieta yms. CORS:n v√§√§rin konfiguroiminen, jolloin API:in p√§√§sy v√§√§rilt√§ tahoilta.

## [A10:2021 ‚Äì Server-Side Request Forgery (SSRF)](https://owasp.org/Top10/A10_2021-Server-Side_Request_Forgery_%28SSRF%29/)

SSRF puute ilmenee aika websovelluksen hakiessa  et√§resurssia ilman, ett√§ k√§ytt√§j√§n antamaa URL:ia validoidaan. Nyky√§√§n loppuk√§ytt√§j√§t joutuvat websovelluksien nykyisen rakenteen takia t√§llaiseen tilanteeseen, jossa SSRF on mahdollinen ja tapaukset ovat nousussa, koska URL-osoitteen hakeminen on yleist√§.

SSRF on estett√§viss√§ sovelluksen kehitysvaiheessa eri kerrokissa. Network layer (verkkokerros), application layer (sovelluskerros). √Ñl√§ deployaa tietoturvaan liittyvi√§ palveluita frontissa, kuten OpenID:t√§. Frontendiss√§ k√§ytt√§j√§ryhmille verkkojen salaus. My√∂s HTTP uudelleenohjauksen poistaminen. 

## [Access control vulnerabilities and privilege escalation](https://portswigger.net/web-security/access-control)

P√§√§synhallinta tarkoittaa rajoitusten asettamista k√§ytt√§jille. Verkkosovelluksessa se perustuu k√§ytt√§j√§n tunnistamiseen (autentikointi) ja istunnonhallintaan:

Autentikointi varmistaa k√§ytt√§j√§n olevan se kenen pit√§isi olla. Istunnonhallinta tunnistaa, mitk√§ seuraavat HTTP-pyynn√∂t tehd√§√§n samalta k√§ytt√§j√§lt√§. P√§√§synhallinta m√§√§rittelee, onko k√§ytt√§j√§ll√§ oikeus suorittaa toiminto, jota h√§n yritt√§√§ tehd√§. Broken access control on yleinen ja aiheuttaa usein suuria tietoturvariskej√§.

## [Server-side template injection](https://portswigger.net/web-security/server-side-template-injection)

Server-side template injection (SSTI) tekniikalla hy√∂kk√§√§j√§ pystyy alkuper√§isen mallisyntaksin avulla lis√§t√§ haitallisen latausmateriaalin malliin, joka suoritetaan palvelimen puolella.
Palvelinpuolen mallirikkoutumiset voivat tapahtua, kun k√§ytt√§j√§n sy√∂te liitet√§√§n suoraan malliin sen sijaan, ett√§ se v√§litett√§isiin datana. Palvelinpuolen mallirikkoutumisen vaikutukset voivat altistaa verkkosivustot erilaisille hy√∂kk√§yksille riippuen k√§ytetyst√§ mallimoottorista ja siit√§, miten sovellus k√§ytt√§√§ sit√§. Joissakin harvinaisissa tilanteissa n√§m√§ haavoittuvuudet eiv√§t aiheuta todellista tietoturvallisuusriski√§. Kuitenkin suurimman osan ajasta palvelinpuolen mallirikkoutumisen vaikutukset voivat olla katastrofaalisia.

## [Cross-site scripting](https://portswigger.net/web-security/cross-site-scripting)

Cross-site scripting (XSS) on verkkoturvahaavoittuvuus. Yleens√§ cross-site scripting -haavoittuvuudet mahdollistavat hy√∂kk√§√§j√§n esiintyv√§n uhrina ja suorittaa kaikki toimet, joita k√§ytt√§j√§ voi tehd√§ sek√§ p√§√§st√§ k√§siksi kaikkiin k√§ytt√§j√§n tietoihin. Jos uhrilla on eritysoikeuksia sovelluksessa, voi siis hy√∂kk√§√§j√§ saada t√§yden hallinnan sovelluksen toiminnasta ja tiedoista.

XSS toimii manipuloimalla haavoittuvaa verkkosivustoa palauttaen k√§ytt√§j√§lle haitallista JavaScripti√§. Haitallinen koodi suoritetaan uhrin selaimessa ja sitten hy√∂kk√§√§j√§ voi tehd√§ sovelluksesta haavoittuvan.

## [Server-side request forgery (SSRF)](https://portswigger.net/web-security/ssrf)

Server-side request forgery (SSRF) on verkkoturvahaavoittuvuus, joka mahdollistaa hy√∂kk√§√§j√§n aiheuttaa palvelinpuolen sovelluksen tekem√§√§n pyynt√∂j√§ tarkoittamattomaan sijaintiin. SSRF-hy√∂kk√§yksess√§ hy√∂kk√§√§j√§ pyrkii muodostamaan palvelimen ja yrityksen infran v√§lille yhteyden.

## [Try Web Hacking on New Webgoat 2023.4](https://terokarvinen.com/2023/webgoat-2023-4-ethical-web-hacking/)

- Asenna Java ja palomuuri
- Lataa WebGoat JAR [Githubista](https://github.com/WebGoat/WebGoat/releases)
- Aja WebGoat vaihtoehtoisessa portissa, jos 8080 on jo k√§yt√∂ss√§.
- Tarkasta toimiiko


# a) Totally Legit Sertificate

Ladataan [OWASP ZAP](https://www.zaproxy.org/download/) ja sopivin JAR on "Cross Platform Package"

![0](https://github.com/Viktorialissa/PenTest/assets/112398757/dfaebe72-8db5-4e25-aa60-87395bef84f4)


Asennetaan:

    sudo apt-get install openjdk-17-jre

![1](https://github.com/Viktorialissa/PenTest/assets/112398757/3fd7742e-9c0b-410e-81c8-fc4a9ead4a96)

Luodaan uusi hakemisto komennolla:

    mkdir zap

Siirret√§√§n zippi tiedosto zap kansioon ja puretaan se.

![6](https://github.com/Viktorialissa/PenTest/assets/112398757/10f55feb-75ec-4e69-a718-e989b1cda0ac)


Avataan tiedosto

    java -jar <tiedosto>
  
![8](https://github.com/Viktorialissa/PenTest/assets/112398757/df9dad9b-7d72-4a23-9892-db339421b718)

Aukeaa ja laitetaan enismm√§iseen kohtaan valinta. Sitten painetaan start.

![9](https://github.com/Viktorialissa/PenTest/assets/112398757/f0467153-45a8-448e-95e7-4cc055197a3c)
![10](https://github.com/Viktorialissa/PenTest/assets/112398757/b8f027f0-84cd-46a1-ab39-5795bb55381f)

Avataan selain sielt√§ settings ja haetaan proxy

![11](https://github.com/Viktorialissa/PenTest/assets/112398757/57bf52b9-f5ac-4875-9ee1-892766427550)
![proxyHHTPS](https://github.com/Viktorialissa/PenTest/assets/112398757/19f38712-34b5-4834-8bcd-3f303a367a2d)

Tehd√§√§n sertifikaatti zapilla ja otetaan se k√§ytt√∂√∂n. Avataan zapissa toolseista options. Etsit√§√§n certificate. Tallennetaan sertifikaatti Zap-kansioon.

![14](https://github.com/Viktorialissa/PenTest/assets/112398757/ae352d8f-85df-4d1c-9159-e2331ceafb55)
![15](https://github.com/Viktorialissa/PenTest/assets/112398757/b08ed617-df53-4de1-b368-145ed6ee35f4)
![16](https://github.com/Viktorialissa/PenTest/assets/112398757/effd9fb4-f8e6-4fa7-9ea2-6f274a8b15ec)
![17](https://github.com/Viktorialissa/PenTest/assets/112398757/68e18f5a-2961-4b71-8922-c0154b92221b)
![18](https://github.com/Viktorialissa/PenTest/assets/112398757/8efbad2d-dac8-409a-b968-1284b0e7df99)


Otetaan selaimessa sertifikaatti k√§ytt√∂√∂n. Haetaan hakusanalla certificate selaimen settingseiss√§.

![19](https://github.com/Viktorialissa/PenTest/assets/112398757/e229f50b-7b2b-44a1-8fbc-e683f6f7ee29)

Importataan valittu sertifikaatti.

![20](https://github.com/Viktorialissa/PenTest/assets/112398757/6fdfeeaa-a643-48f4-a0dc-2e5e0bb271f8)
![21](https://github.com/Viktorialissa/PenTest/assets/112398757/c7591ed3-e2c0-4fac-90c5-7fb9108a4054)

Luotetaan sertifikaattiin.

![22](https://github.com/Viktorialissa/PenTest/assets/112398757/a4a1426c-1469-40b5-b299-bb25dfcf717e)
![23](https://github.com/Viktorialissa/PenTest/assets/112398757/ecf1e6a2-71ee-4772-b365-ad69a145e17e)

### T√§m√§n teht√§v√§n tekeminen loppuu kesken 15.11 üïí 17.00.

# b) Kettumaista

Asennetaan firefoxin lis√§osa foxyproxy. Menn√§√§n selaimessa lis√§osiin ja etsit√§√§n sielt√§ oikea foxyproxy standard.

# En saanut asennettua, koska Lapissa ei ollut nettiyhteytt√§ niin, ett√§ virtuaalikone olisi py√∂rinyt.


### Aloitetaan teht√§vien tekeminen üìÜ 15.11.2023 üïí 17.00.

# PortSwigger Labs
## c) Insecure direct object references

Inspekti auki ja networks sitten hoveroi ladatun tiedoston yll√§ niin polku tulee esiin. Laita urliin se ja vaihda 1.txt

Sitten avaat tiedoston ja n√§et salasanan.
28-31
![28](https://github.com/Viktorialissa/PenTest/assets/112398757/f9574ca3-5060-4976-a06c-ba3d78c9771d)
![29](https://github.com/Viktorialissa/PenTest/assets/112398757/09bd3964-434b-4f6f-a017-e8bb43801b83)
![30](https://github.com/Viktorialissa/PenTest/assets/112398757/9c87c549-0083-4961-a5bc-2d590153da5a)
![31](https://github.com/Viktorialissa/PenTest/assets/112398757/8c9bbc61-9f13-4b17-901f-56f214077b4b)

# Path traversal
## d) File path traversal, simple case

Hy√∂dynnet√§√§n haavoittuvuutta tiedostopolussa tuotekuvia tutkiessa. Piti p√§√§st√§ /etc/passwd hakemistoon. 

![33](https://github.com/Viktorialissa/PenTest/assets/112398757/a267d83e-69d9-4620-a4a7-bb37007a55bf)

![32](https://github.com/Viktorialissa/PenTest/assets/112398757/eeb4f5c8-31f5-43e2-b094-f51b3872e165)

## e) File path traversal, traversal sequences blocked with absolute path bypass

Teht√§v√§ss√§ tuli l√∂yt√§√§ ``/etc/passwd`` tiedoston tiedot. 
![34](https://github.com/Viktorialissa/PenTest/assets/112398757/a8822d51-4437-4207-8c56-56343078a15d)

## f) File path traversal, traversal sequences stripped non-recursively

Haavoittuvuus on tuotteiden kuvissa. Piti l√∂yt√§√§ ``/etc/passwd`` tiedosto k√§ytt√§m√§ll√§ nested tiedostopolkua eli ``....//....//``

![35](https://github.com/Viktorialissa/PenTest/assets/112398757/33180772-0edf-4343-9a53-19dd43894fd2)


# Server Side Template Injection (SSTI)
## g) Server-side template injection with information disclosure via user-supplied objects (T√§m√§ on merkitty hieman vaikeammaksi, j√§t√§ viimeiseksi jos n√§ytt√§√§ hankalalta)


# Server Side Request Forgery (SSRF)
## h) Basic SSRF against the local server

Teht√§v√§ss√§ Stock check eli varastosaldojen tarkastuksessa p√§√§si poistamaan k√§ytt√§j√§n Carlos. 

![36](https://github.com/Viktorialissa/PenTest/assets/112398757/5a3e9346-798f-4acf-8928-8e8552a8b4ae)


# Cross Site Scripting (XSS)
## i) Reflected XSS into HTML context with nothing encoded

Teht√§v√§n tarkoituksena oli hy√∂dynt√§√§ cross-site scripting haavoittuvuutta, joka oli hakutoiminnossa.

![37](https://github.com/Viktorialissa/PenTest/assets/112398757/ca358060-de3a-426f-96bd-4a1579920056)
![38](https://github.com/Viktorialissa/PenTest/assets/112398757/7923e515-5d9e-43b6-92fa-84f6bc3a65ae)

## j) Stored XSS into HTML context with nothing encoded

Havoittuvuus l√∂ytyy kommenttikent√§ss√§ t√§ss√§ teht√§v√§ss√§.
Navigoi comments kohtaan ja kirjoita sinne ``<script>alert(1)</script>``

t√§yt√§ loput tiedot ja send.

![39](https://github.com/Viktorialissa/PenTest/assets/112398757/f79cec4b-e0d3-4008-90e5-f8c08a64254d)


## k) Asenna Webgoat 2023.4. (Uusi versio, jossa on eri teht√§vi√§ kuin vanhemmissa)

Aloitin asentamalla palomuurin komennolla:

  sudo apt-get install ufw

Asennuksen j√§lkeen laitetaan palomuuri p√§√§lle komennolla:

  sudo ufw enable

Java oli asennettu jo aikaisemmin, joten sit√§ ei en√§√§ t√§ss√§ viaheessa tarvitse asentaa.

Asennetaan seuraavaksi uusin versio Webgoatista [githubista](https://github.com/WebGoat/WebGoat/releases)

  wget https://github.com/WebGoat/WebGoat/releases/download/v2023.4/webgoat-2023.4.jar

OWASP ZAP oli aikaisemmassa teht√§v√§ss√§ asennettu py√∂rim√§√§n porttiin 8080, joten m√§√§ritet√§√§n toinen portti Webgoatille samalla, kun k√§ynnistet√§√§n se javalla k√§ytt√§en komentoa:

  java -Dfile.encoding=UTF-8 -Dwebgoat.port=8888 -Dwebwolf.port=9090 -jar webgoat-2023.4.jar

# En p√§√§se en√§√§ tekem√§√§n teht√§vi√§, koska netti ei toimi Lapissa....

# Ratkaise WebGoat 2023.4:
## m) (A1) Broken Access Control (WebGoat 2023.4)
### Hijack a session (1)
### Insecure Direct Object References (4)
### Missing Function Level Access Control (3)
### Spoofing an Authentication Cookie (1)
## n) (A7) Identity & Auth Failure (WebGoat 2023.4)
### Authentication Bypasses (1)
### Insecure Login (1)
## o) (A10) Server-side Request Forgery (WebGoat 2023.4)
### Server-Side Request Forgery (2)
## p) Client side (WebGoat 2023.4)
### Bypass front-end restrictions (2)

## L√§hteet:

- Tero Karvinen luento 13.11.2023.
- [Tero Karvinen - teht√§v√§](https://terokarvinen.com/2023/eettinen-hakkerointi-2023/#h4-totally-legit-sertificate). Luettu 15.11.2023.
- Muut materiaalit, jotka ovat linkkein√§ raportissa.


